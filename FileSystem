File System in Linux

File system is logical collection of files on partition or disk

It is normal to have n=more than 1 partitions

#partition naming

/dev/xxyN

dev is name of the directory where all device files presents
xx is type of the device on which partition is present hd is for IDE disks and sd is for SCSI disks
y device on which partition is present
N denotes partiotion 1-4 (Primary) >5 (logical)

FIle system/Partition config files

#fstab - static information about the filesystems

/etc/fstab is file contains all available disks, partitions and mounts.
Each line contains six fields as follows

1) Device
2) Mount point/path
3) File System
4) Options --> default option is defaults.
5) Backup option [0 or 1](if value == 1; then dump utility will take backup)
6) File system check order --> 0 means fsdisk will not check file system. Higher number will be order for checking file system.

Sample Line from /etc/fstab
/dev/sda1	/mnt/demo	ext4	acl,users_xattr	0	0


#get UUID for the block device e.g. HDD
blkid /dev/sda3
/dev/sda3: LABEL="2G" UUID="f80b1161-c490-4bc8-990b-30a47609e91f" TYPE="ext4" PARTUUID="0d65f401-03"


#list devices
ls /dev


#inode
An inode is a data structure that stores various information about a file in Linux, such as the access mode (read, write, execute permissions), ownership, file type, file size, group, number of links, etc. Each inode is identified by an integer number. An inode is assigned to a file when it is created.

Some file systems (most notably ext3) create all inodes when the file system is created. This means that it is possible to run out of storage because all of the inodes are used, although there is available space on the disk. Other file systems (like xfs) create inodes as needed.

#get inode counts
df -ih

Filesystem     Inodes IUsed IFree IUse% Mounted on
rootfs            999 -976K  977K     - /



none              999 -976K  977K     - /dev

#get inode for file
 ls -il
 
 #get stat about file inode
 
>stat simple.txt
  File: simple.txt
  Size: 70              Blocks: 0          IO Block: 512    regular file
Device: 2h/2d   Inode: 1970324837250862  Links: 1
Access: (0666/-rw-rw-rw-)  Uid: ( 1000/   anand)   Gid: ( 1000/   anand)
Access: 2020-06-09 10:19:05.306685200 +0530
Modify: 2020-06-09 17:01:32.094964700 +0530
Change: 2020-06-09 17:01:32.094964700 +0530
 Birth: -
 
 #inode for directory
ls -ild
2533274790517518 drwxr-xr-x 1 anand anand 512 Jun  9 16:32 .


#There are 3 kind of "timestamps":

Access - the last time the file was read
Modify - the last time the file was modified (content has been modified)
Change - the last time meta data of the file was changed (e.g. permissions)


Last access time
Time when file data last accessed.
Changed by the mknod(2), utimes(2) and read(2) system calls.

Last modified time
Time when file data last modified.
Changed by the mknod(2), utimes(2) and write(2) system calls.

Last changed time
Time when file status was last changed (inode data modification).
Changed by the chmod(2), chown(2), link(2), mknod(2), rename(2), unlink(2), utimes(2) and write(2) system calls.


#create hard link
ln <link_name> <file_name>

#create soft/symbolic link
ln -s <file_name> <link_name>

#remove symbolic links
rm <symbolic_links>
unlink symlink_name


#check files and devices mounted

mount

rootfs on / type lxfs (rw,noatime)
none on /dev type tmpfs (rw,noatime,mode=755)
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,noatime)
proc on /proc type proc (rw,nosuid,nodev,noexec,noatime)
devpts on /dev/pts type devpts (rw,nosuid,noexec,noatime,gid=5,mode=620)
none on /run type tmpfs (rw,nosuid,noexec,noatime,mode=755)


Some linux group media and devices in /media and /mnt directories

#update partition table
partprobe /dev/sda

######### Mounting Drive Partition #########

sudo mount /dev/sda3 /media/anand


######### Unmount Drive Partition #########

sudo umount /media/anand

#get disks
sudo fdisk -l | grep '/dev/sda*'
Disk /dev/sda: 26 GiB, 27917287424 bytes, 54525952 sectors
/dev/sda1  *        2048  1050623  1048576  512M  b W95 FAT32
/dev/sda2        1052670 41940991 40888322 19.5G  5 Extended
/dev/sda3       41940992 46135295  4194304    2G 83 Linux
/dev/sda5        1052672 41940991 40888320 19.5G 83 Linux


##making file ext4 system 

sudo mkfs.ext4 /dev/sda3

mke2fs 1.45.5 (07-Jan-2020)
/dev/sda3 contains a ext4 file system labelled '2G'
	last mounted on Sat Jun 27 03:26:42 2020
Proceed anyway? (y,N) y
Creating filesystem with 524288 4k blocks and 131072 inodes
Filesystem UUID: 383cd3fa-9484-4599-b2d3-51a948c8dcf9
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 

#list available file systems to create

mkfs {TAB} {TAB}
mkfs         mkfs.ext2    mkfs.fat     mkfs.ntfs    
mkfs.bfs     mkfs.ext3    mkfs.minix   mkfs.vfat    
mkfs.cramfs  mkfs.ext4    mkfs.msdos 




#lsblk --> list block devices

>lsblk

NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0    7:0    0    55M  1 loop /snap/core18/1705
loop1    7:1    0    55M  1 loop /snap/core18/1754
loop2    7:2    0 255.6M  1 loop /snap/gnome-3-34-1804/36
loop3    7:3    0 240.8M  1 loop /snap/gnome-3-34-1804/24
loop4    7:4    0  62.1M  1 loop /snap/gtk-common-themes/1506
loop5    7:5    0  49.8M  1 loop /snap/snap-store/433
loop6    7:6    0  49.8M  1 loop /snap/snap-store/467
loop7    7:7    0  27.1M  1 loop /snap/snapd/7264
loop8    7:8    0  29.8M  1 loop /snap/snapd/8140
sda      8:0    0    26G  0 disk 
├─sda1   8:1    0   512M  0 part /boot/efi
├─sda2   8:2    0     1K  0 part 
├─sda3   8:3    0     2G  0 part 
└─sda5   8:5    0  19.5G  0 part /
sr0     11:0    1  1024M  0 rom  

#steps to create partitions

fdisk --> create partition --> format partition using mkfs --> mount file system

#create partition

sudo fdisk /dev/sda

m --> information

F --> list free unpartitioned space

p --> print partition table


####### Print Partitions ############

Command (m for help): p
Disk /dev/sda: 26 GiB, 27917287424 bytes, 54525952 sectors
Disk model: VMware Virtual S
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x0d65f401

Device     Boot   Start      End  Sectors  Size Id Type
/dev/sda1  *       2048  1050623  1048576  512M  b W95 FAT32
/dev/sda2       1052670 41940991 40888322 19.5G  5 Extended
/dev/sda5       1052672 41940991 40888320 19.5G 83 Linux


######### Create Partition #########


Command (m for help): n
Partition type
   p   primary (1 primary, 1 extended, 2 free)
   l   logical (numbered from 5)
Select (default p): 

Using default response p.
Partition number (3,4, default 3): 6
Value out of range.
Partition number (3,4, default 3): 3
First sector (41940992-54525951, default 41940992): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (41940992-54525951, default 54525951): +2GB 

Created a new partition 3 of type 'Linux' and of size 1.9 GiB.


